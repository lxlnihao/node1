name: Node auto deployment
on:
  push:
    branches: [ develop ] #监听master分支的push事件
jobs:
  build:
    runs-on: ubuntu-latest #指定运行环境为最新的Ubuntu版本
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Deploy to Server
        uses: cross-the-world/ssh-scp-ssh-pipelines@latest
       with:
        host: ${{ secrets.LDD_SERVER_IP }} # 服务器的ip
        user: ${{ secrets.LDD_SERVER_NAME }} # 服务器的账号
        pass: ${{ secrets.LDD_SERVER_PASSWORD }} # 服务器的密码
        connect_timeout: 60s
        #将build生成的文件从GitHub服务器的相应目录，传到我服务器的相应目录
        scp: | 
          ./* => /home/node_pro/node1
        last_ssh: | #这部分是在服务器上，传输文件后执行的命令，新版本重新安装依赖并运行
          cd /home/node_pro/node1
          pm2 restart index.js
